#!/usr/bin/env python3
"""
å¿«é€ŸéªŒè¯ - æµ‹è¯•å¢å¼ºç‰ˆèŠå¤©æ•ˆæœï¼ˆä¸éœ€è¦åŠ è½½å®Œæ•´ç´¢å¼•ï¼‰
"""

import sys
sys.path.append('src')

from enhanced_chat import EnhancedChat

def main():
    print("="*80)
    print("ğŸ§ª å¢å¼ºç‰ˆèŠå¤©æ•ˆæœå¿«é€ŸéªŒè¯")
    print("="*80)
    print("\nè¿™ä¸ªæµ‹è¯•ä¸éœ€è¦åŠ è½½å¤§æ–‡ä»¶ï¼Œåªæµ‹è¯•æç¤ºè¯æ•ˆæœ\n")
    
    api_key = "sk-cdebe0fafcf9406d962e3e09a0404e4b"
    chat = EnhancedChat(api_key)
    
    # æ¨¡æ‹Ÿä¸Šä¸‹æ–‡
    test_cases = [
        {
            "query": "å¾å‡¤å¹´ä¸ºä»€ä¹ˆè¦æ€éŸ©è²‚å¯ºï¼Ÿ",
            "context": """
ã€äººç‰©èƒŒæ™¯ã€‘
å¾å‡¤å¹´ï¼šåŒ—å‡‰ç‹ä¸–å­ï¼Œæ¯äº²å´ç´ è¢«éŸ©è²‚å¯ºå‚ä¸æ€å®³
éŸ©è²‚å¯ºï¼šç¦»é˜³å¤ªç›‘é¦–é¢†ï¼Œäººç§°"äººçŒ«"ï¼Œå‚ä¸äº¬åŸç™½è¡£æ¡ˆ

ã€ç›¸å…³åŸæ–‡ã€‘
1. éŸ©è²‚å¯ºå‚ä¸äº¬åŸç™½è¡£æ¡ˆï¼Œå¯¼è‡´å´ç´ æ­»äº¡
2. å¾å‡¤å¹´åœ¨å¤ªå®‰åŸå¤–è®¾å±€å‡»æ€éŸ©è²‚å¯º
3. éŸ©è²‚å¯ºæ­»å‰æ‰¿è®¤æ€å®³å¾å‡¤å¹´æ¯äº²
            """
        },
        {
            "query": "ç‹ä»™èŠä¸ºä»€ä¹ˆè‡ªç§°å¤©ä¸‹ç¬¬äºŒï¼Ÿ",
            "context": """
ã€äººç‰©èƒŒæ™¯ã€‘
ç‹ä»™èŠï¼šæ­¦å¸åŸä¸»ï¼Œå½“ä¸–æœ€å¼ºæ­¦å¤«
ææ·³ç½¡ï¼šä¸Šä¸€ä»£å‰‘ç¥

ã€ç›¸å…³åŸæ–‡ã€‘
1. ç‹ä»™èŠè‡ªç§°å¤©ä¸‹ç¬¬äºŒï¼Œç¬¬ä¸€çš„ä½ç½®ç©ºç€
2. è¿™æ˜¯å› ä¸ºä»–å¯¹ææ·³ç½¡çš„æ•¬æ„
3. ææ·³ç½¡å½“å¹´æ­¦å¸åŸä¸€æˆ˜ï¼Œæ‰‹ä¸‹ç•™æƒ…
            """
        },
        {
            "query": "å¾å‡¤å¹´å’Œå§œæ³¥çš„ç»“å±€æ˜¯ä»€ä¹ˆï¼Ÿ",
            "context": """
ã€äººç‰©èƒŒæ™¯ã€‘
å¾å‡¤å¹´ï¼šåŒ—å‡‰ç‹
å§œæ³¥ï¼šè¥¿æ¥šäº¡å›½å…¬ä¸»ï¼Œæœ¬åå§œå§’

ã€ç›¸å…³åŸæ–‡ã€‘
1. å§œæ³¥è¢«å¾å‡¤å¹´ä»è¥¿æ¥šçš‡å®«å¸¦èµ°
2. ä¸¤äººé’æ¢…ç«¹é©¬ï¼Œå†ç»ç£¨éš¾
3. æœ€ç»ˆåœ¨ä¸€èµ·ï¼Œå§œæ³¥æˆä¸ºåŒ—å‡‰ç‹å¦ƒ
            """
        }
    ]
    
    for i, case in enumerate(test_cases, 1):
        print("\n" + "="*80)
        print(f"ã€æµ‹è¯• {i}/{len(test_cases)}ã€‘")
        print(f"â“ é—®é¢˜: {case['query']}")
        print("="*80)
        
        print("\nğŸ¤– ç”Ÿæˆå›ç­”...")
        result = chat.chat(case['query'], case['context'], temperature=0.7)
        
        if result['success']:
            print(f"\nğŸ’¬ å›ç­” ({result['usage']['total_tokens']} tokens):")
            print("-" * 80)
            print(result['answer'])
            print("-" * 80)
            
            # åˆ†æå›ç­”ç‰¹ç‚¹
            print("\nğŸ“Š å›ç­”ç‰¹ç‚¹åˆ†æ:")
            answer = result['answer']
            if 'æˆ‘è®°å¾—' in answer or 'å°è¯´é‡Œ' in answer:
                print("   âœ… ä½¿ç”¨äº†è‡ªç„¶çš„è¡¨è¾¾æ–¹å¼")
            if 'è¯´å®è¯' in answer or 'æ„Ÿæ…¨' in answer or 'æ„Ÿå—' in answer:
                print("   âœ… åŒ…å«äº†æƒ…æ„Ÿå’Œè§è§£")
            if 'ä¸åªæ˜¯' in answer or 'æ›´æ·±å±‚' in answer or 'å…¶å®' in answer:
                print("   âœ… è¿›è¡Œäº†åˆ†ææ¨ç†")
            if 'æ ¹æ®ç¬¬' not in answer and 'åŸæ–‡ç¬¬' not in answer:
                print("   âœ… æ²¡æœ‰æœºæ¢°çš„å­¦æœ¯è…”")
        else:
            print(f"âŒ é”™è¯¯: {result['error']}")
    
    print("\n" + "="*80)
    print("âœ… å¿«é€ŸéªŒè¯å®Œæˆ!")
    print("\nç»“è®º:")
    print("  å¦‚æœä»¥ä¸Šå›ç­”è‡ªç„¶ã€æœ‰æƒ…æ„Ÿã€ä¼šåˆ†æ â†’ å¢å¼ºç‰ˆæ•ˆæœOK âœ…")
    print("  å¦‚æœå›ç­”æœºæ¢°ã€ç½—åˆ—åŸæ–‡ â†’ éœ€è¦è°ƒæ•´ âŒ")
    print("="*80)

if __name__ == "__main__":
    main()
